<Window x:Class="PersonalFinanceManager.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:PersonalFinanceManager.Application.ViewModel;assembly=PersonalFinanceManager.Application"
        xmlns:models="clr-namespace:PersonalFinanceManager.Domain.Models;assembly=PersonalFinanceManager.Domain"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        Title="Personal Finance Manager" Height="700" Width="1000">



    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

 
    <Window.DataContext>
        <vm:TransactionListViewModel/>
    </Window.DataContext>

    <TabControl>
        <!-- ====== 1) TRANSACTIONS TAB ====== -->
        <TabItem Header="Transactions">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- FILTER CONTROLS -->
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
                    <TextBlock Text="From:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <DatePicker SelectedDate="{Binding FilterStartDate}" Width="120" Margin="0,0,10,0"/>
                    <TextBlock Text="To:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <DatePicker SelectedDate="{Binding FilterEndDate}" Width="120" Margin="0,0,20,0"/>

                    <TextBlock Text="Category:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <ComboBox SelectedValue="{Binding FilterCategory}" SelectedValuePath="Tag"
                    Width="120" Margin="0,0,20,0">
                        <ComboBoxItem Content="All" Tag="{x:Null}"/>
                        <ComboBoxItem Content="{x:Static models:Category.Groceries}" Tag="{x:Static models:Category.Groceries}"/>
                        <ComboBoxItem Content="{x:Static models:Category.Rent}"      Tag="{x:Static models:Category.Rent}"/>
                        <ComboBoxItem Content="{x:Static models:Category.Salary}"    Tag="{x:Static models:Category.Salary}"/>
                        <ComboBoxItem Content="{x:Static models:Category.Utilities}" Tag="{x:Static models:Category.Utilities}"/>
                        <ComboBoxItem Content="{x:Static models:Category.Entertainment}" Tag="{x:Static models:Category.Entertainment}"/>
                        <ComboBoxItem Content="{x:Static models:Category.Other}"     Tag="{x:Static models:Category.Other}"/>
                    </ComboBox>

                    <TextBlock Text="Type:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <ComboBox SelectedValue="{Binding FilterType}" SelectedValuePath="Tag"
                    Width="100">
                        <ComboBoxItem Content="All" Tag="{x:Null}"/>
                        <ComboBoxItem Content="{x:Static models:TransactionType.Income}"  Tag="{x:Static models:TransactionType.Income}"/>
                        <ComboBoxItem Content="{x:Static models:TransactionType.Expense}" Tag="{x:Static models:TransactionType.Expense}"/>
                    </ComboBox>
                </StackPanel>

                <!-- CRUD BUTTONS -->
                <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,10">
                    <Button Content="Add"    Click="AddButton_Click"    Width="75" Margin="0,0,10,0"/>
                    <Button Content="Edit"   Click="EditButton_Click"   Width="75" Margin="0,0,10,0"/>
                    <Button Content="Delete" Click="DeleteButton_Click" Width="75" Margin="0,0,10,0"/>
                    <Button Content="Undo"   Click="UndoButton_Click"   Width="75" Margin="20,0,10,0"
                  IsEnabled="{Binding CanUndo}"/>
                    <Button Content="Redo"   Click="RedoButton_Click"   Width="75"
                  IsEnabled="{Binding CanRedo}"/>
                </StackPanel>

                <!-- DATA GRID -->
                <DataGrid x:Name="TransactionsDataGrid"
                  Grid.Row="2"
                  ItemsSource="{Binding FilteredTransactions}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  SelectionMode="Single">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Date"        Binding="{Binding Date, StringFormat=d}"/>
                        <DataGridTextColumn Header="Category"    Binding="{Binding Category}"/>
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}"/>
                        <DataGridTextColumn Header="Amount"      Binding="{Binding Amount, StringFormat=C}"/>
                        <DataGridTextColumn Header="Type"        Binding="{Binding Type}"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- FILTERED LIST -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                    <TextBlock Text="Total Income: " FontWeight="Bold"/>
                    <TextBlock Text="{Binding TotalIncome, StringFormat=C}" Margin="0,0,20,0"/>
                    <TextBlock Text="Total Expense: " FontWeight="Bold"/>
                    <TextBlock Text="{Binding TotalExpense, StringFormat=C}" Margin="0,0,20,0"/>
                    <TextBlock Text="Balance: " FontWeight="Bold"/>
                    <TextBlock Text="{Binding Balance, StringFormat=C}"/>
                </StackPanel>
            </Grid>
        </TabItem>


        <!-- ====== 2) STATISTICS TAB ====== -->
        <TabItem Header="Statistics">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Checkboxi za prikaz/skrivanje -->
                <StackPanel Orientation="Horizontal" Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,10">
                    <CheckBox Content="Prikaži stroške"
                IsChecked="{Binding ShowExpensesChart}"
                Margin="0,0,20,0"/>
                    <CheckBox Content="Prikaži prihodke"
                IsChecked="{Binding ShowIncomeChart}"/>
                </StackPanel>

                <!-- Grafa drug ob drugem -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Tortni graf stroškov -->
                    <lvc:PieChart Grid.Column="0"
                    Series="{Binding ExpenseByCategorySeries}"
                    LegendLocation="Right"
                    Visibility="{Binding ShowExpensesChart, Converter={StaticResource BoolToVis}}"/>

                    <!-- Stolpčni graf prihodkov -->
                    <lvc:CartesianChart Grid.Column="1"
                         Series="{Binding IncomeByCategorySeries}"
                         LegendLocation="Right"
                         Visibility="{Binding ShowIncomeChart, Converter={StaticResource BoolToVis}}">
                        <lvc:CartesianChart.AxisX>
                            <lvc:Axis Labels="{Binding IncomeByCategoryLabels}"
                    Title="Kategorija"/>
                        </lvc:CartesianChart.AxisX>
                        <lvc:CartesianChart.AxisY>
                            <lvc:Axis Title="Znesek"/>
                        </lvc:CartesianChart.AxisY>
                    </lvc:CartesianChart>
                </Grid>
            </Grid>
        </TabItem>

    </TabControl>
</Window>
